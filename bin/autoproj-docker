#! /usr/bin/env ruby
require 'autoproj/docker'

rebuilds = []
options = OptionParser.new do |opt|
    opt.on('--rebuild[=LIST]', Array, "list of builds to redo from scratch, do not give any name to rebuild all") do |build_names|
        rebuilds =
            if !build_names || build_names.empty? then config['builds']
            else build_names
            end
    end
end
config_file, *_ = options.parse(ARGV)

config = Autoproj::Docker::Config.load(config_file)
builds = config.resolve
builds.each do |b|
    puts "starting #{b}"
    b.run
end
